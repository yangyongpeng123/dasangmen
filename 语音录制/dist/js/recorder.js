//devin87@qq.com
//build:2015/12/30 08:59:59
!function(e,t){"use strict";function a(t){t=t||{};var a=this;a.bufferSize=t.bufferSize||16384,a.numChannels=t.numChannels||1,a.bitRate=t.bitRate||128,a.ops=t,a.support=!!(e.AudioContext&&navigator.getUserMedia&&e.Worker),a.init()}e.AudioContext=e.AudioContext||e.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,a.prototype={constructor:a,init:function(){var e=this;if(e.support){var t=e.ops,a=t.complete,o=t.error,r=new AudioContext,n=new Worker(t.WORKER_PATH||"js/recorder-worker.js");n.onmessage=function(e){var t=e.data,r=t.data;switch(t.cmd){case"complete":a&&a(r,"audio/mp3");break;case"error":o&&o(r)}},e.inputSampleRate=r.sampleRate,e.outputSampleRate=t.sampleRate||e.inputSampleRate,n.postMessage({cmd:"init",data:{numChannels:e.numChannels,sampleBits:e.sampleBits,inputSampleRate:e.inputSampleRate,outputSampleRate:e.outputSampleRate,bitRate:e.bitRate}}),e.context=r,e.worker=n}},start:function(e,t){var a=this;navigator.getUserMedia({audio:!0},function(t){var o=a.context,r=a.worker,n=a.numChannels,i=o.createMediaStreamSource(t),s=(o.createScriptProcessor||o.createJavaScriptNode).call(o,a.bufferSize,n,n);s.onaudioprocess=function(e){if(!a._paused){for(var t=[],o=0;n>o;o++)t.push(e.inputBuffer.getChannelData(o));r.postMessage({cmd:"encode",data:t})}},i.connect(s),s.connect(o.destination),a.source=i,a.processor=s,"function"==typeof e&&e()},t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1},stop:function(){var e=this;e.source&&e.source.disconnect(),e.processor&&e.processor.disconnect(),e.worker&&e.worker.postMessage({cmd:"stop"})}},e.MP3Recorder=a}(window);